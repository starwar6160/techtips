#DVCS选择#
##DVCS(分布式版本控制系统)的特点##
* 好处
	* 日常使用99%的操作都在本地进行，无需网络，所以速度远超SVN等集中式版本控制系统
	* 由于**所有**日常操作无需网络，所以在比如银行内部网之类与互联网隔绝的地方可以进行现场开发，版本控制提交，回到公司之后再把更改合并到其他人的版本库中；
	* 只有在与其他人交流协作时才需要网络，中央服务器可以设立，但**不是必需的**；
	* 所有人都有某一个版本库的所有一切内容，所以天然形成了容灾备份，不存在CVS，SVN等系统的中央服务器单点故障风险；
	* 本地仓库的存在给了开发者更大的自由，允许开发者频繁提交而无需顾忌是否每一次提交都不会破坏现有功能，在代码经过若干次提交到达稳定状态时再与中央数据库同步。
	* 实际上不止于代码，一切纯文本的东西，包括HTML,XML,INI，配置文件等原始形式为纯文本的东西，都可以用DVCS来进行版本控制；

* 缺点  
	* DVCS天生不像CVCS(集中式版本控制系统比如SVN)那样具备完善的权限管理，精细的权限控制；但是这一点可以通过模块化，把大项目分解为一个个小的版本库，然后针对单个小的版本库来决定访问权限来解决；而且CVCS的精细权限控制是需要在中央服务器端付出很大的管理代价的；  
	* DVCS处理二进制文件尤其是大型的，反复修改的二进制文件的能力不如CVCS，比如大型图片，视频，光盘镜像，二进制数据等等；如果有这方面的需求，最好把该部分单独出来，使用ftp，NFS，Windows文件共享,ownCloud等传统文件管理方式来进行；  
* 建议
	* 如果从人员学习成本考虑，建议学习hg，这个软件非常容易使用，无论是命令行还是GUI都很容易使用；我曾经多次在*几分钟内*教会对于版本控制系统一无所知的同事学会其*基本使用方法*，并迅速发挥了很大作用，大大提高了开发工作的效率；而且hg自带一个web服务器，无需中央版本库就可以很方便的在同事之间进行小组协作开发，弥补了其中央服务器架设不容易的缺点；
	* 如果从完善的中央版本库(对于DVCS而言不是必需的)的角度来说，则建议学习git；虽然git的学习成本较高，概念多一些，更容易让人迷惑一些，但是学会最基本的git使用方法并不比hg难多少；而且git的代码托管网站，第三方的git服务器软件等生态系统都比较完善；
* 保密问题
	* 关于保密的问题，建议主要还是从管理，法律角度来做，而非从技术角度；技术手段做到保密，代价极高，对于日常工作影响很大；
	* 虽然DVCS系统每个人都有完整的版本库，但这一点可以通过合理规划，把项目划分为多个子项目，然后对于重要的子项目严格保密来实现；
	* 即便是SVN，也可以很容易的通过脚本自动获取整个版本库的内容，只是麻烦一些，而且SVN要做完善的权限管理，在服务器端所要花费的代价非常高；


##目前主流的**开源免费**DVCS:Git,Mercurial(hg)##
###git###
* [git](http://baike.baidu.com/view/1531489.htm) 最流行的开源免费分布式版本控制系统，Linux核心的作者Linus Torvalds的另一个名作；速度快，功能强大，因此学习成本也高于mercurial(hg)，扎根于linux平台，最适合在Linux，命令行使用，对Windows系统的支持不如hg;但是日常简单使用，利用TortoiseGit图形客户端操作的话没多大问题；服务器架设方面资源丰富，已有gitlab这个完善的服务器软件；
* 使用git的大型，著名开源项目有：Linux Kernel，Perl，Eclipse，Gnome，KDE，Qt，Android，Debian，X.org，Ruby on Rails，PostgreSQL等。

###Mercurial(hg)###
* [Mercurial(hg)](http://baike.baidu.com/view/1094619.htm)  稍晚于git出现的开源免费分布式版本控制系统，用Python语言写成，核心性能关键部分用C写成，跨平台支持很好，原生支持Windows；学习成本低，无论是命令行还是GUI操作都比较简单，命令非常接近SVN，方便具有SVN经验的人迁移过来；
* hg自身有一个内置Web服务器，在一个本机版本库上面右键点击一下就可以启动一个版本库发布服务器，非常方便小组之间直接协同开发，git就没有这个；
* Mercurial对Linux，Mac和Windows平台有良好的支持，支持通过Web方式访问代码库，并存在成熟的IntelliJ、Eclipse插件，最终成为了很多需要进行跨国团队协作开发的公司选择分布式版本控制系统的胜出者；[为什么我们要放弃Subversion](http://www.infoq.com/cn/articles/thoughtworks-practice-partiv)
* 但其生态系统不如git，比如托管服务主要只有[bitbucket](https://bitbucket.org/),[google code](https://code.google.com)等少数几家，服务器软件比较少，而且比较难架设，架设资料少；
* 其客户端TortoiseHg的中文支持，主要限于UTF-8，其他编码容易出现乱码；
* 使用hg的大型，著名开源项目有：Open Solaris,Mozilla,OpenJDK,Symbian OS,The Xen hypervisor,NetBeans;

##DVCS中央服务器软件现状##
###git###
* 公有托管网站  
	* [github](https://github.com):最流行的开源代码托管网站，托管私有代码要收费，7美元/月起，包含5个私有仓库；
	* 国内公有:
	    * gitcafe    
	    * code.jd.com  
* 自有服务器软件  
	* gitlab:是一个对于github的完全模仿的开源系统，中文支持没有问题，Web管理功能完善，适合用来架设自己的版本控制服务器；[bitnami gitlab](http://bitnami.com/stack/gitlab)是一个预先做好的gitlab虚拟机，还可以直接在[Amazon EC2弹性计算云](http://aws.amazon.com/cn/ec2/)上面部署，几分钟就可以部署一台自己的服务器，使用费用每小时8美分左右；
	* gitorious:自行架设有一定难度，即便是预先配置好的虚拟机，也会遇到无法登录问题需要研究解决；

###hg###
* 公有托管网站  
* [bitbucket](https://bitbucket.org/):可以有合计1G空间，最多5用户，免费无限个私有仓库；安全性上应该没有问题，是和github齐名的两大开源代码仓库托管网站；
* 自有：  
	* Apache+mercurial:简陋，无Web管理，可以手工编辑配置文件控制单个仓库为单位的授权；
	* [RhodeCode](https://rhodecode.com/):完整的Web管理，使用简单，但是部署稍有难度，默认配置有中文乱码，经过努力后暂时仍有提交记录的中文乱码暂未解决，但有俄语用户的类似问题已经解决，应该可以解决；
mercurial-server:简陋的手工编辑配置文件控制单个仓库为单位的授权；

##相关参考文章##
###[分布式版本控制系统入门](http://www.ibm.com/developerworks/cn/aix/library/au-dist_ver_control/)###
* DVCS  和集中式版本控制系统的主要差异  
	* 在 DVCS 和集中式版本控制系统之间有三个关键差异。第一个差异是，DVCS 通过本地提交支持离线工作，这是由 DVCS 的操作方式决定的。这与集中式版本控制完全不同，集中式版本控制要求通过到中心服务器的连接执行所有操作。**这种灵活性让开发人员在飞机上也能够像在办公室中一样轻松地工作**，可以一次又一次地进行提交。  
	* 第二个差异是 DVCS 比集中式系统更灵活，因为 DVCS 支持许多不同类型的工作流，从传统的集中式工作流到纯粹的特殊工作流，再到特殊工作流和集中式工作流的组合。这种灵活性允许通过电子邮件、对等网络和开发团队喜欢的任何方式进行开发。  
	* 第三个差异是 DVCS 比集中式版本控制系统***快得多***，因为大多数操作在客户机上进行，**速度非常快**。另外，在需要进行推（push ）操作（与另一个节点通信）时，速度也更快，因为两个客户机机器上都有完整的元数据。速度差异相当显著，根据使用本地存储库还是网络存储库，DVCS 比 Subversion 快大约 3-10 倍。  

###[为什么软件项目从集中式迁移到分布式版本控制系统的热情持续不减?](https://github.com/brantyoung/zh-why-projects-moving-to-dvcs)###
* 版本控制系统是软件项目协作开发必不可或缺的工具. 很多开源和闭源的项目都在积极准备, 或是已经把它们的源码库从集中式的版本控制系统 (CVCS) 迁移到分布式版本控制系统 (DVCS). 本文我们将总结 CVCS 和 DVCS 的区别, 并记述一些项目为了证明迁移的合理性, 提出的理论依据和预期收效.  
* 迁移到DVCS期望的收效
	* 方便所有开发人员的访问:    
大多数项目向 DVCS 迁移的关键原因之一是: 对非提交者更友好. 没有提交权限的贡献者在开发时很难从 CVCS 中受益, 常常需要采用创建并行库的方式来管理较大的代码变更. 在 Python 的讨论中, 这个问题被特别强调, 因为 CVCS 最大的局限就是 "任何为 Python 写补丁或对其进行定制的开发人员, 版本修订时得不到工具的直接支持". Perl 基金会强调 DVCS 必须是开源的, 以确保社区所有成员都可以使用该工具. OpenOffice 开发过程主要依赖 CVS 分支, 开发人员 必须要有该库的写权限  
**在 DVCS 中, 每个贡献者有他们自己的库**, 而且他们能够 "随时保存他们的工作进度, 让开发过程更轻松". Torvalds (GIT 之父) 认为分布式系统的特性避免了项目围绕着获取 (和回收) 向中央库提交代码权限的政治纷争 [10] (译注: 关于 Torvalds 政治纷争的观点详细解释可 进一步阅读). 当贡献者正在进行重大修改, 或评审过程需要贡献者反复修改提交的代码时, 这个特点显得尤为重要.  
	* 支持原子变更:  
NetBSD 和 OpenOffice 项目最紧迫的需求是要求新的 VCS 支持源码库范围的原子提交. 两个团队都遭遇过使用 CVS 分支导致库朽化, 而且这个问题可能难以修复.
	* **简单的自动合并**:  
DVCS 保存了充足的信息来支持自动和反复合并, 长期维护的分支之间常常会进行这类合并. Python 项目认为这是一个重要特性, 主要出于两个原因. 
		* 一, 改进对合并的支持可以鼓励开发人员保持他们的分支和主干开发同步, 并降低他们的分支趋向陈旧过期的风险.   
		* 二, 改进对合并的支持减少提交者的负担, Perl 项目也认为这点很重要. 交换简单的补丁文件会有版本不匹配的风险, 补丁作者使用的版本和补丁评审者的版本很可能不一致. DVCS 生成的补丁文件包含充分的依赖信息, 以甄别补丁是否依赖其它没有提交的修订版本, 由此减少判断 "问题补丁" 的工作量. 同时依赖信息能有效的鉴别共同祖先, 有利于改进补丁的合并工作.  
	* 改进对 "试验田" 的支持:  
Perl 和 OpenOffcie 项目试图加强对非提交者的支持, 让他们在提交修改进行合并之前能够自主的进行试验. 低成本的分支让开发人可以进行本地提交, 跟踪和记录开发进度, 这种方式通常很适合着手一些对结果不确定的尝试性工作.
	* **支持离线操作**:  
Python 项目格外希望支持离线操作, 一个在开发者乘飞机旅行时非常有用的特性. CVCS 工具要求开发人员必须连上服务器才能对源码库进行访问和查询. 这种离线的特性把提交修改 (如新建快照) 从公布修改 (译注: 指提交到中央库, 让其他人也能看到修改) 中分离出来 [3].